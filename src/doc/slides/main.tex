% Created 2024-04-02 Tue 06:13
% Intended LaTeX compiler: pdflatex
\documentclass{beamer}
 		 

\input{switches}
\input{style/style-common}
\input{style/style-presentation}
\input{preamble}
\input{macros}
\input{macros-tmp}
\renewcommand{\maketitle}{}
\def\mytitle{Compiler Construction}    %% what for?
\def\myauthor{Martin Steffen}          %% what for?
\def\mydate{Spring 2024}               %% what for?
\usetheme{default}
\usecolortheme{}
\usefonttheme{}
\useinnertheme{}
\useoutertheme{}
\date{Spring 2024}
\title{INF5110 -- Oblig 2}

\hypersetup{
 pdfauthor={},
 pdftitle={INF5110 -- Oblig 2},
 pdfkeywords={compiler, compiler construction},
 pdfsubject={compiler construction},
 pdfcreator={Emacs 29.2 (Org mode 9.7-pre)}, 
 pdflang={English}}
\begin{document}

\maketitle
\section{Intro}
\label{sec:org69ce5b7}
\begin{frame}[label={sec:org8237cf1},fragile]{Goal}
 \begin{enumerate}
\item \alert{semantic  analysis}, as far as 
\begin{itemize}
\item \alert{typing} is concerned (``static semantics'')
\item other coditions (no duplicate declaration etc)
\end{itemize}

\item \alert{code generation} for \texttt{compila24} (ish) programs
\end{enumerate}
\end{frame}
\begin{frame}[label={sec:orgbbb5ed6}]{Last time (O1)}
\begin{block}{Syntactic analysis}
\begin{itemize}
\item lexer (scanner)
\item parser
\item abstract syntax tree
\end{itemize}
\end{block}
\alert{this time}: continue with your previous deliv. (and repos)
\end{frame}
\begin{frame}[label={sec:org266228b}]{Learning outcome}
\begin{itemize}
\item understand type checking, implementing a simple variant
\end{itemize}


\begin{itemize}
\item understand (simple form of) bytecode and how to generate it from ``source
code'' (as AST)

\item extend an existing compiler code base with new functionality
\end{itemize}
\end{frame}
\section{Semantic analysis}
\label{sec:org2497f86}
\begin{frame}[label={sec:org0464c4f}]{Semantic analysis \& type checking}
\begin{itemize}
\item parser / context-free  grammars 
\begin{itemize}
\item not powerful enough
\item cannot check all (static) properties of a language spec
\end{itemize}

\item => extend the front-end by a type checker

\begin{itemize}
\item use the AST classes of last time
\item add type checking code
\item allowed to make \alert{changes} or adaptations if advantagous.
\end{itemize}
\end{itemize}
\end{frame}
\begin{frame}[label={sec:org6539703}]{Another glance at compila23}
\includegraphics[width=\textwidth]{figures/snaps/compilaexample-checking}


NB: 2024: minor different syntax (e.g. structs, not classes)
\end{frame}
\begin{frame}[label={sec:orge8ae659},fragile,plain]{Type checking for conditionals}
 \begin{itemize}
\item as ``inspiration'', details may vary
\end{itemize}


\begin{lstlisting}[language=java,numbers=none]
  class IfStatement extends Statement {
  ...
    public void typeCheck(){
      String condType = condition.get.Type ();
      if (condType != "bool") {  
         throw new TypeException("condition in an if 
           statement must be of type bool")
      }
}
\end{lstlisting}
\end{frame}
\begin{frame}[label={sec:orgb723957},fragile,plain]{Type checking: assignments}
 \begin{lstlisting}[language=java,numbers=none]
class Assignment extends Statement {
...
  public void typeCheck() {
    String varType = var.getType();
    String expType = exp.getType();
    if (varType != expType &&
       !isAssigmentCompatible(varType,expType){
                 throw new TypeException("Cannot assign " + vartpe + 
                 " from " + expType);
  }
}

\end{lstlisting}
\end{frame}
\section{Code generation}
\label{sec:org15a5bd6}
\begin{frame}[label={sec:org49ea5c0},fragile]{Code generation}
 \begin{itemize}
\item byte code API and operations are described in the document ``Interpreter
and bytecode for INF5110'' (part of the \texttt{compila} repos under \texttt{doc})

\item \alert{Task:} add bytecode generation methods to your AST classes
for instance
\end{itemize}

\begin{verbatim}
Ast.Node.GenerateCode(...)
\end{verbatim}
\begin{itemize}
\item again: if adaptations of the AST are called for or useful, go for it\ldots{}
\end{itemize}
\end{frame}
\begin{frame}[label={sec:org778d95f},fragile]{Code generation: limitations}
 \begin{itemize}
\item interpreter and byte code library somewhat \alert{limited}
\begin{itemize}
\item cannot express full compila 24
\item no block structure
\item no reference types
\end{itemize}
\end{itemize}


\begin{itemize}
\item your delivery should support generating correct bytecode
for the \texttt{compila} 24 source code file \texttt{runme.cmp}
\end{itemize}
\end{frame}
\begin{frame}[label={sec:org5174717},fragile,plain]{Code generation: creating a procedure}
 \begin{lstlisting}[language=java,numbers=none]
CodeFile codeFile = new CodeFile();
// add the procedure by name first
codeFile.addProcedure("Main")
// then define it
CodeProcedure main = new 
   CodeProcedure("Main", VoidType,TYPE, codeFile);
main.addInstruction( new RETURN());
//then update it in the code file
codeFile.updateProcedure(main);
\end{lstlisting}
\end{frame}
\begin{frame}[label={sec:org34edd90}]{Code generation: assignment}
\begin{center}
 \includegraphics[width=0.76\textwidth]{figures/snaps/codegen-assignment}
\end{center}
\end{frame}
\section{Testing}
\label{sec:org8fb8fce}
\begin{frame}[label={sec:org4bd83c8},fragile]{Testing}
 \begin{itemize}
\item bunch of test files, for testing the \emph{type checker}
\item preferable: make \texttt{ant test} workable

\item test files inside \texttt{./tests/semanticanalysis/errors/} (and with \texttt{fail} in
the filename) contain a syntactically correct but erronous program
(erroneous as the type system or generally the semantic phase is
concerned)

\item => compiler returns error code 2 for semantic failure
\end{itemize}
\end{frame}
\section{Starting point and hand in}
\label{sec:org29de54a}
\begin{frame}[label={sec:orgedfebaf}]{Provided source code (patch)}
\url{https://github.uio.no/compilerconstruction-inf5110/compila}

\includegraphics[width=0.96\textwidth]{figures/snaps/directorystructure-src}

Tests: already included in the oblig1 checkout, so left out in the zip-patch
this year.
\end{frame}
\begin{frame}[label={sec:org79ceddc}]{Provided documentation (patch)}

\begin{center}
 \includegraphics[width=0.75\textwidth]{figures/snaps/directorystructure-doc}
\end{center}
\end{frame}
\begin{frame}[label={sec:org355e2f4},fragile]{Relevant directories}
 \begin{itemize}
\item Java

\begin{itemize}
\item \texttt{compiler}: updated compiler class (patch)
\item \texttt{test}:   some code for performing tests (patch)
\item \texttt{bytecode}: classes for constructing bytecode (already there)
\item \texttt{runtime}: rte for executing the byte code (already there)
\end{itemize}

\item Compila

\begin{itemize}
\item \texttt{tests}: some test files (including \texttt{runme.cmp})
\end{itemize}
\end{itemize}
\end{frame}
\begin{frame}[label={sec:org4e6ce35},fragile]{Deadline}
 \begin{alertblock}{Deadline}
   (Wednesday, 15. 05. 2024)
\end{alertblock}
Note: end of semester, and I need to report the ones passing the oblig some
time before the exam.
\begin{block}{delivs}
\begin{itemize}
\item working type checker
\item code generator (test with \texttt{runme.cmp})
\item report (including your name(s) etc.

\begin{itemize}
\item discussion of your solution, choices you made, assumptions you rely on

\item printout of a test run (can be also checked in into the repos, but it 
needs to be mentioned where it is)
\item printout of the bytecode from \texttt{runme.cmp} (with a target like \texttt{ant
    list-runme})

\item solution must ``build'' and be ``testable'' (typically via \texttt{ant})
\end{itemize}
\end{itemize}
\end{block}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
\end{document}
