% Created 2019-04-10 Wed 14:55
% Intended LaTeX compiler: pdflatex
\documentclass{beamer}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{textcomp}
\usepackage{amssymb}
\usepackage{capt-of}
\usepackage{hyperref}
\input{switches}
\input{style/style-common}
\input{style/style-presentation}
\input{preamble}
\input{macros}
\input{macros-tmp}
\renewcommand{\maketitle}{}
\def\mytitle{Compiler Construction}    %% what for
\def\myauthor{Martin Steffen}   %% what for
\def\mydate{Spring 2019}        %% what for
\usetheme{default}
\usecolortheme{}
\usefonttheme{}
\useinnertheme{}
\useoutertheme{}
\date{Spring 2019}
\title{INF5110 -- Oblig 1 + 2}

\hypersetup{
 pdfauthor={},
 pdftitle={INF5110 -- Oblig 1 + 2},
 pdfkeywords={compiler, compiler construction},
 pdfsubject={compiler construction},
 pdfcreator={Emacs 24.3.1 (Org mode 9.2.2)}, 
 pdflang={English}}
\begin{document}

\maketitle
\section{Oblig 1}
\label{sec:orgc60b42f}



\subsection{Compila 19}
\label{sec:orga73d465}

\begin{frame}[label={sec:org33bd579}]{Oblig 1}
\begin{itemize}
\item material (also for oblig 2) based on previous years, including contributions from Eyvind
W. Axelsen, Henning Berg, Fredrik SÃ¸rensen, and others
\end{itemize}


\begin{itemize}
\item see also the course web-page, containing links to ``resources''
\end{itemize}
\end{frame}


\begin{frame}[label={sec:orgf46450f}]{Goal (of oblig 1)}
\begin{block}{Parsing}
Determine if programs written in \emph{Compila 19} are syntactically correct: 

\begin{itemize}
\item scanner
\item parser
\end{itemize}
\end{block}


\begin{block}{Rest}
\begin{itemize}
\item first part of a compiler, oblig 2 will add to it
\item language spec provided separatly
\end{itemize}
\end{block}
\end{frame}


\begin{frame}[label={sec:org8b9c223}]{Learning outcomes}
\begin{itemize}
\item using \alert{tools} for parser/scanner generation
\begin{itemize}
\item JFlex
\item CUP
\end{itemize}

\item variants of a grammar for the same languages

\begin{itemize}
\item \alert{transforming} one form (EBNF) to another (compatible with the used
tools)

\item controlling \alert{precedence} and \alert{associativity}
\end{itemize}

\item designing and implementing an \alert{AST}  data structure

\begin{itemize}
\item using the parsing tools to build such trees
\item pretty-printing such trees
\end{itemize}
\end{itemize}
\end{frame}


\begin{frame}[label={sec:org1c15c21}]{Compila language at a glance}

\lstinputlisting[basicstyle=\scriptsize,emph={begin,end,in, proc,program,var,return,struct}]{code/myprogram.cmp}
\end{frame}



\begin{frame}[label={sec:org4c73df2},plain]{Another glance}

\lstinputlisting[basicstyle=\scriptsize,emph={begin,end,in, proc,program,var,return,struct}]{code/swap.cmp}
\end{frame}


\begin{frame}[label={sec:orge7549d3},plain]{Grammar (1): declarations}

%~/cor/teaching/compila/src/doc/languagespec/
\lstinputlisting[basicstyle=\scriptsize,lastline=14]{../../doc/languagespec/grammar.txt}
\end{frame}






\begin{frame}[label={sec:orgacab7e0},plain]{Grammar (2): declarations}

%~/cor/teaching/compila/src/doc/languagespec/
\lstinputlisting[basicstyle=\scriptsize,firstline=15,lastline=40]{../../doc/languagespec/grammar.txt}
\end{frame}




\begin{frame}[label={sec:org310ecb8},plain]{Grammar (3): statements and types}

%~/cor/teaching/compila/src/doc/languagespec/
\lstinputlisting[basicstyle=\scriptsize,firstline=41]{../../doc/languagespec/grammar.txt}
\end{frame}




\subsection{Tools}
\label{sec:org8f4f4ea}

\begin{frame}[label={sec:org0e661a7},fragile]{Tools: JFlex}
 \begin{itemize}
\item scanner generator (or lexer generator) tool

\begin{itemize}
\item \alert{input}: lexical specification
\item \alert{output}: scanner program in Java
\end{itemize}

\item lexical spec written as \texttt{.lex} file

\item consists of \alert{3 parts}

\begin{itemize}
\item user code
\item options and macros
\item lexical rules
\end{itemize}
\end{itemize}
\end{frame}


\begin{frame}[label={sec:orga8ba78b}]{Sample lex code}
\includegraphics[width=\textwidth]{figures/snaps/lexcode}
\end{frame}



\begin{frame}[label={sec:orgcf092e0},fragile]{CUP: Construction of useful parsers (for Java)}
 \begin{itemize}
\item a tool to easily (ymmv) generate \emph{parsers}

\item reads tokes from the scanner using \texttt{next\_token()}
\item the \texttt{\%cup} option (previous slide) makes that work
\end{itemize}



\begin{block}{Input}
grammar in BNF with \alert{action} code

\begin{verbatim}
var_decl ::= VAR ID:name COLON type:vtype
 {: RESULT =  new VarDecl(name, vtype); :};
\end{verbatim}
\end{block}


\begin{block}{Rest}
\begin{itemize}
\item \alert{output}: parser program (in Java)
\end{itemize}
\end{block}
\end{frame}


\begin{frame}[label={sec:org40ef0a7}]{Sample CUP code}
\includegraphics[width=\textwidth]{figures/snaps/cupcode}
\end{frame}



\begin{frame}[label={sec:org867891d},fragile]{Build tool: ant}

 \begin{center}
 \includegraphics[width=0.2\textwidth]{figures/snaps/antlogo}
\end{center}


\begin{itemize}
\item Java-based build tool (think ``make'')
\item config in \texttt{build.xml}
\item can contain different \alert{targets}
\end{itemize}

\begin{block}{typical general targets}
\begin{itemize}
\item test
\item clean
\item build
\item run
\end{itemize}
\end{block}

\begin{block}{Rest}
\begin{itemize}
\item supplied configuration should take care of calling \texttt{jflex}, \texttt{cup}, and
\texttt{javadoc} for you
\end{itemize}
\end{block}
\end{frame}

\begin{frame}[label={sec:org80adcdb}]{AST data structure}

\begin{center}
 \includegraphics[width=0.8\textwidth]{figures/snaps/astclasses}
\end{center}
\end{frame}




\begin{frame}[label={sec:orgee6e378},fragile]{Overview over the directory + first steps}
 \begin{itemize}
\item see the Readme at/from the \texttt{github.uio.no}
\end{itemize}


\includegraphics[width=0.66\textwidth]{figures/snaps/directorystruct}
\end{frame}



\begin{frame}[label={sec:org0197927}]{Building: putting it together}

\begin{center}
 \includegraphics[width=0.8\textwidth]{figures/snaps/buildprocess}
\end{center}
\end{frame}

\subsection{Official}
\label{sec:org20a01d5}

\begin{frame}[label={sec:org921298e},fragile]{Deadline}
 \begin{alertblock}{Deadline}
\alert{Friday 15. 03. 2019, 23:59}
\end{alertblock}


\begin{block}{Rest}
\begin{itemize}
\item don't miss the deadline
\item for extensions, administration needs to agree (\texttt{studadm}), contact them
if sick etc
\item even if not 100\% finished
\begin{itemize}
\item deliver what you have
\item contact early when problems arise
\end{itemize}
\end{itemize}
\end{block}
\end{frame}


\begin{frame}[label={sec:org65164d7},fragile]{Deliverables}
 \begin{itemize}
\item see also the ``handout''
\end{itemize}

\begin{block}{Deliverables (1)}
\begin{itemize}
\item working \alert{parser}
\begin{itemize}
\item parse the supplied sample programs
\item printout the resulting AST
\end{itemize}

\item \alert{two} grammars (two \texttt{.cup}-files)

\begin{itemize}
\item one unambiguious
\item one ambiguous, where ambibuities resolved through precedence
declations in \emph{CUP}, e.g.
\end{itemize}
\end{itemize}

\begin{verbatim}
precendence left AND;
\end{verbatim}
\end{block}
\end{frame}


\begin{frame}[label={sec:org52a4e40}]{Deliverables}
\begin{block}{Deliverables (2)}
\begin{itemize}
\item report (with name(s) and UiO user name(s)
\item discussion of the solution (see handout for questions)
\item in particular: comparison of the two grammars
\item ``Readme''
\end{itemize}
\end{block}

\begin{block}{Rest}
\begin{itemize}
\item the code must \emph{build} (with ant) and run
\item test it on the  UiO RHEL (linux) platform
\end{itemize}
\end{block}

\begin{block}{Ask}
If problems, \alert{ask in time}  (\alert{NOT} Friday at the deadline)
\end{block}
\end{frame}



\begin{frame}[label={sec:org73477b6},fragile]{Hand-in procedure}
 \begin{itemize}
\item this year we try \emph{git}

\item \url{https://github.uio.no} resp. \url{https://github.uio.no/msteffen/compila}

\item you need

\begin{itemize}
\item a login
\item send me emails that you want to do oblig (+ potential partner)
\(\Rightarrow\) I tell you group number
\item create a project \texttt{compila<n>} (\(n\) = group number)
\item add collaborator + (at some point me)
\end{itemize}
\end{itemize}


\begin{itemize}
\item see also the handout
\end{itemize}
\end{frame}





\section{Oblig2}
\label{sec:org795fc05}


\begin{frame}[label={sec:orge5611c3},fragile]{Goal}
 \begin{enumerate}
\item \alert{semantic  analysis}, as far as 
\begin{itemize}
\item \alert{typing} is concerned (``static semantics'')
\item other coditions (no duplicate declaration etc)
\end{itemize}

\item \alert{code generation} for \texttt{compila19} (ish) programs
\end{enumerate}
\end{frame}






\begin{frame}[label={sec:org4a2e64a}]{Last time (O1)}
\begin{block}{Syntactic analysis}
\begin{itemize}
\item lexer (scanner)
\item parser
\item abstract syntax tree
\end{itemize}
\end{block}



\alert{this time}: continue with you previous deliv (and repos)
\end{frame}



\begin{frame}[label={sec:org998a7d0}]{Learning outcome}
\begin{itemize}
\item understand type checking, implementing a simmple variant
\end{itemize}


\begin{itemize}
\item undertand (simple form of) bytecode and how to generate it from ``source
code'' (as AST)

\item extend an existing compiler code base with new functionality
\end{itemize}
\end{frame}



\begin{frame}[label={sec:org1a51c98}]{Semantic analysis \& type checking}
\begin{itemize}
\item parser / context-free  grammars 
\begin{itemize}
\item not powerfull enough
\item cannot check all (static) properties of a language spec
\end{itemize}

\item => extend the front-end by a type checker

\begin{itemize}
\item use the AST classes of last time
\item add type checking code
\item allowed to make \alert{changes} or adaptations if advantagous.
\end{itemize}
\end{itemize}
\end{frame}


\begin{frame}[label={sec:org3810fb8}]{Another glance at compila19}
\includegraphics[width=\textwidth]{figures/snaps/compilaexample-checking}


NB: 2019: structs, not classes 
\end{frame}


\begin{frame}[label={sec:orgcb01965},fragile,plain]{Type checking for conditionals}
 \begin{itemize}
\item as ``inspiration'', details may vary
\end{itemize}


\lstset{language=java,label= ,caption= ,captionpos=b,numbers=none}
\begin{lstlisting}
  class IfStatement extends Statement {
  ...
    public void typeCheck(){
      String condType = condition.get.Type ();
      if (condType != "bool") {  
	 throw new TypeException("condition in an if 
	   statement must be of type bool")
      }
}
\end{lstlisting}
\end{frame}


\begin{frame}[label={sec:org55554f4},fragile,plain]{Type checking: assignments}
 \lstset{language=java,label= ,caption= ,captionpos=b,numbers=none}
\begin{lstlisting}
class Assignment extends Statement {
...
  public void typeCheck() {
    String varType = var.getType();
    String expType = exp.getType();
    if (varType != expType &&
       !isAssigmentCompatible(varType,expType){
		 throw new TypeException("Cannot assign " + vartpe + 
		 " from " + expType);
  }
}

\end{lstlisting}
\end{frame}



\begin{frame}[label={sec:org5a7eafc},fragile]{Code generation}
 \begin{itemize}
\item lecture(s) of code gen start right now (so it might look puzzling, but
hopefully will become clearer)
\item byte code API and operations are described in the document ``Interpreter
and bytecode for INF5110''

\item \alert{Task:} add bytecode generation methods to your AST classes
for instance
\end{itemize}

\begin{verbatim}
Ast.Node.GenerateCode(...)
\end{verbatim}
\begin{itemize}
\item again: if adaptations of the AST are called for or useful, go for it\ldots{}
\end{itemize}
\end{frame}


\begin{frame}[label={sec:orgc928d1b},fragile]{Code generation: limitations}
 \begin{itemize}
\item interpreter and byte code library somewhat \alert{limited}
\begin{itemize}
\item cannot express full compila 19
\item no block structure
\item no reference types
\end{itemize}
\end{itemize}


\begin{itemize}
\item your delivery should support generating correct bytecode
for the \texttt{compila} 19 source code file \texttt{runme.cmp}
\end{itemize}
\end{frame}



\begin{frame}[label={sec:orgb1b6439},fragile,plain]{Code generation: creating a procedure}
 \lstset{language=java,label= ,caption= ,captionpos=b,numbers=none}
\begin{lstlisting}
CodeFile codeFile = new CodeFile();
// add the procedure by name first
codeFile.addProcedure("Main")
// then define it
CodeProcedure main = new 
   CodeProcedure("Main", VoidType,TYPE, codeFile);
main.addInstruction( new RETURN());
//then update it in the code file
codeFile.updateProcedure(main);
\end{lstlisting}
\end{frame}

\begin{frame}[label={sec:org57f870a}]{Code generation: assignment}
\begin{center}
 \includegraphics[width=0.76\textwidth]{figures/snaps/codegen-assignment}
\end{center}
\end{frame}



\begin{frame}[label={sec:org717b5bd},fragile]{Testing}
 \begin{itemize}
\item bunch of test files, for testing the \emph{type checker}
\item preferable: make \texttt{ant test} workable

\item test files ending with \texttt{fail} containt a syntactically correct but
erronous program (erroneous as the type system or generally the semantic
phase is concerned)

\item => compiler returns error code 2 for semantic failure
\end{itemize}
\end{frame}



\begin{frame}[label={sec:orgface421}]{Provided source code}
\url{https://github.uio.no/msteffen/compila}

\includegraphics[width=0.76\textwidth]{figures/snaps/directorystruct}
\end{frame}



\begin{frame}[label={sec:orgfb2ccad},fragile]{Provided source code}

 \begin{center}
 \includegraphics[width=0.75\textwidth]{figures/snaps/directory-src}
\end{center}



\begin{itemize}
\item \texttt{compiler}: updated compiler class
\item \texttt{test}:   some code for performing tests
\item \texttt{bytecode}: classes for constructing bytecode
\item \texttt{runtime}: rte for executing the byte code
\end{itemize}
\end{frame}



\begin{frame}[label={sec:org6bba1ee},fragile]{Deadline}
 \begin{alertblock}{Deadline}
12th May  2019
\end{alertblock}



Note: end of semester, and I need to report the ones passing the oblig some
time before the exam.


\begin{block}{delivs}
\begin{itemize}
\item working type checker
\item code generator (test with \texttt{runme.cmp})
\item report (including your name(s) etc.

\begin{itemize}
\item discussion of your solution, choices you made, assumptions you rely on

\item printout of a test run (can be also checked in into the repos, but it n
needs to be mentioned where it is)
\item printout of the bytecode from \texttt{runme.cmp} (with a target like \texttt{ant
    list-runme})

\item solution must ``build'' and be ``testable'' (typically via \texttt{ant})
\end{itemize}
\end{itemize}
\end{block}
\end{frame}



\subsection{References}
\label{sec:orgda6971a}

\begin{frame}[allowframebreaks]
  \frametitle{References}
  {\tiny
    \bibliographystyle{apalike}
%    \bibliography{extracted,local} 
    \bibliography{string,semantics,etc,mobile,crossref}  %general PMA
  }
\end{frame}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
\end{document}